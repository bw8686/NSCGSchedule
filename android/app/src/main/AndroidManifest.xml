<manifest xmlns:android="http://schemas.android.com/apk/res/android">
    <uses-permission android:name="android.permission.INTERNET" />
    <uses-permission android:name="android.permission.REQUEST_INSTALL_PACKAGES" />
    <!-- Image-only permission for Android 13+ -->
    <uses-permission android:name="android.permission.READ_MEDIA_IMAGES" />
    <!-- Fallback for older Android versions (up to API 32) -->
    <uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" android:maxSdkVersion="32" />
    <!-- Camera permission for scanning/profile pictures -->
    <uses-permission android:name="android.permission.CAMERA" />
    <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
    <uses-permission android:name="android.permission.RECEIVE_BOOT_COMPLETED"/>
    <uses-permission android:name="android.permission.SCHEDULE_EXACT_ALARM" />
    <application
        android:label="NSCGSchedule"
        android:name="${applicationName}"
        android:icon="@mipmap/ic_launcher"
        android:usesCleartextTraffic="true"
        android:networkSecurityConfig="@xml/network_security_config">
        <activity
            android:name=".MainActivity"
            android:exported="true"
            android:launchMode="singleTop"
            android:taskAffinity=""
            android:theme="@style/LaunchTheme"
            android:configChanges="orientation|keyboardHidden|keyboard|screenSize|smallestScreenSize|locale|layoutDirection|fontScale|screenLayout|density|uiMode"
            android:hardwareAccelerated="true"
            android:windowSoftInputMode="adjustResize">
            <!-- Specifies an Android theme to apply to this Activity as soon as
                 the Android process has started. This theme is visible to the user
                 while the Flutter UI initializes. After that, this theme continues
                 to determine the Window background behind the Flutter UI. -->
            <meta-data
              android:name="io.flutter.embedding.android.NormalTheme"
              android:resource="@style/NormalTheme"
              />
            <intent-filter>
                <action android:name="android.intent.action.MAIN"/>
                <category android:name="android.intent.category.LAUNCHER"/>
            </intent-filter>
            <!-- Enable Open on Watch button for Wear OS -->
            <intent-filter>
                <action android:name="android.intent.action.VIEW" />
                <category android:name="android.intent.category.DEFAULT" />
                <category android:name="com.google.android.wearable.app.OPEN_ON_PHONE" />
                <data android:scheme="nscgschedule" />
            </intent-filter>
            <!-- Deep link handler for widgets -->
            <intent-filter android:autoVerify="true">
                <action android:name="android.intent.action.VIEW" />
                <category android:name="android.intent.category.DEFAULT" />
                <category android:name="android.intent.category.BROWSABLE" />
                <data android:scheme="nscgschedule" android:host="timetable" />
                <data android:scheme="nscgschedule" android:host="exams" />
            </intent-filter>
        </activity>
        
        <!-- ============================================ -->
        <!-- LESSON WIDGETS (4 styles)                   -->
        <!-- ============================================ -->
        
        <!-- STYLE 1: Next Lesson Compact Widget (2x1) -->
        <receiver
            android:name=".widgets.NextLessonCompactWidget"
            android:exported="false"
            android:label="@string/widget_lesson_label_compact">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_next_lesson_compact_info" />
        </receiver>
        
        <!-- STYLE 2: Next Lesson Card Widget (2x2) -->
        <receiver
            android:name=".widgets.NextLessonCardWidget"
            android:exported="false"
            android:label="@string/widget_lesson_label_card">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_next_lesson_card_info" />
        </receiver>
        
        <!-- STYLE 4: Today's Schedule Detailed Widget (4x3) -->
        <receiver
            android:name=".widgets.TodayScheduleDetailedWidget"
            android:exported="false"
            android:label="@string/widget_lesson_label_detailed">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_today_schedule_detailed_info" />
        </receiver>
        
        <!-- ============================================ -->
        <!-- EXAM WIDGETS (5 styles)                     -->
        <!-- ============================================ -->
        
        <!-- STYLE 5: Next Exam Compact Widget (2x1) -->
        <receiver
            android:name=".widgets.NextExamCompactWidget"
            android:exported="false"
            android:label="@string/widget_exam_label_compact">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_next_exam_compact_info" />
        </receiver>
        
        <!-- STYLE 6: Next Exam Card Widget (2x2) -->
        <receiver
            android:name=".widgets.NextExamCardWidget"
            android:exported="false"
            android:label="@string/widget_exam_label_card">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_next_exam_card_info" />
        </receiver>
        
        <!-- STYLE 8: Exam Countdown Widget (2x2) -->
        <receiver
            android:name=".widgets.ExamCountdownWidget"
            android:exported="false"
            android:label="@string/widget_exam_label_countdown">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_exam_countdown_info" />
        </receiver>
        
        <!-- STYLE 9: Exam Details Widget (4x3) -->
        <receiver
            android:name=".widgets.ExamDetailsWidget"
            android:exported="false"
            android:label="@string/widget_exam_label_details">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_exam_details_info" />
        </receiver>
        
        <!-- ============================================ -->
        <!-- UNIFIED WIDGETS (5 styles)                  -->
        <!-- ============================================ -->
        
        <!-- STYLE 10: Unified Compact Widget (2x2) -->
        <receiver
            android:name=".widgets.UnifiedCompactWidget"
            android:exported="false"
            android:label="@string/widget_unified_label_compact">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_unified_compact_info" />
        </receiver>
        
        <!-- STYLE 12: Unified Full Widget (4x3) -->
        <receiver
            android:name=".widgets.UnifiedFullWidget"
            android:exported="false"
            android:label="@string/widget_unified_label_full">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_unified_full_info" />
        </receiver>
        
        <!-- Don't delete the meta-data below.
             This is used by the Flutter tool to generate GeneratedPluginRegistrant.java -->
        <meta-data
            android:name="flutterEmbedding"
            android:value="2" />
        
        <!-- Widget Update Receiver for scheduled updates -->
        <receiver
            android:name=".widgets.WidgetUpdateReceiver"
            android:exported="false">
            <intent-filter>
                <action android:name="uk.bw86.nscgschedule.UPDATE_WIDGETS" />
                <action android:name="uk.bw86.nscgschedule.UPDATE_LESSON_WIDGETS" />
                <action android:name="uk.bw86.nscgschedule.UPDATE_EXAM_WIDGETS" />
                <action android:name="android.intent.action.TIME_SET" />
                <action android:name="android.intent.action.TIMEZONE_CHANGED" />
                <action android:name="android.intent.action.DATE_CHANGED" />
            </intent-filter>
        </receiver>
        
        <receiver android:exported="false" android:name="com.dexterous.flutterlocalnotifications.ScheduledNotificationReceiver" />
        <receiver android:exported="false" android:name="com.dexterous.flutterlocalnotifications.ScheduledNotificationBootReceiver">
            <intent-filter>
                <action android:name="android.intent.action.BOOT_COMPLETED"/>
                <action android:name="android.intent.action.MY_PACKAGE_REPLACED"/>
                <action android:name="android.intent.action.QUICKBOOT_POWERON" />
                <action android:name="com.htc.intent.action.QUICKBOOT_POWERON"/>
            </intent-filter>
        </receiver>
    </application>
    <!-- Required to query activities that can process text, see:
         https://developer.android.com/training/package-visibility and
         https://developer.android.com/reference/android/content/Intent#ACTION_PROCESS_TEXT.

         In particular, this is used by the Flutter engine in io.flutter.plugin.text.ProcessTextPlugin. -->
    <queries>
        <intent>
            <action android:name="android.intent.action.PROCESS_TEXT"/>
            <data android:mimeType="text/plain"/>
        </intent>
    </queries>
</manifest>
